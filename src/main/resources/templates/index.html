<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${pageTitle}">Sistema Acad√™mico</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<header class="page-header">
    <h1 th:text="${pageTitle}">Sistema Acad√™mico</h1>
    <p>Primeira vers√£o do dashboard acad√™mico com integra√ß√£o MySQL</p>
</header>

<main class="layout">
    <section class="card">
        <h2>Comandos para Alunos</h2>
        <form class="form-grid" data-action="create-aluno">
            <h3>Inserir novo aluno</h3>
            <label>
                Nome
                <input type="text" name="nome" placeholder="Maria Silva" required>
            </label>
            <label>
                Idade
                <input type="number" name="idade" min="16" max="100" placeholder="20" required>
            </label>
            <label>
                Sexo
                <select name="sexo" required>
                    <option value="M">Masculino</option>
                    <option value="F">Feminino</option>
                </select>
            </label>
            <label>
                Rua
                <input type="text" name="rua" placeholder="Rua das Flores">
            </label>
            <label>
                N√∫mero
                <input type="number" name="num" placeholder="123">
            </label>
            <label>
                CEP
                <input type="text" name="cep" placeholder="12345-678">
            </label>
            <button type="submit">Salvar</button>
        </form>
        <form class="form-grid" data-action="update-aluno">
            <h3>Atualizar dados do aluno</h3>
            <label>
                ID do aluno
                <input type="number" name="id" required>
            </label>
            <label>
                Nome
                <input type="text" name="nome" placeholder="Novo nome">
            </label>
            <label>
                Idade
                <input type="number" name="idade" min="16" max="100">
            </label>
            <label>
                Sexo
                <select name="sexo">
                    <option value="">Selecione</option>
                    <option value="M">Masculino</option>
                    <option value="F">Feminino</option>
                </select>
            </label>
            <label>
                M√©dia
                <input type="number" name="media" step="0.1" min="0" max="10" placeholder="7.5">
            </label>
            <label>
                Frequ√™ncia (%)
                <input type="number" name="frequencia" step="0.1" min="0" max="100" placeholder="85.5">
            </label>
            <button type="submit">Atualizar</button>
        </form>
        <form class="form-grid" data-action="delete-aluno">
            <h3>Excluir aluno</h3>
            <label>
                ID do aluno
                <input type="number" name="id" required>
            </label>
            <button type="submit" class="danger">Excluir</button>
        </form>
    </section>

    <section class="card">
        <h2>Comandos para Disciplinas</h2>
        <form class="form-grid" data-action="create-disciplina">
            <h3>Inserir disciplina</h3>
            <label>
                Nome
                <input type="text" name="nome" placeholder="Estat√≠stica Aplicada" required>
            </label>
            <label>
                Carga Hor√°ria
                <input type="number" name="cargaHoraria" min="20" max="120" placeholder="40" required>
            </label>
            <button type="submit">Salvar</button>
        </form>
        <form class="form-grid" data-action="update-disciplina">
            <h3>Atualizar disciplina</h3>
            <label>
                ID disciplina
                <input type="number" name="id" required>
            </label>
            <label>
                Nome
                <input type="text" name="nome" placeholder="Novo nome">
            </label>
            <label>
                Nova carga hor√°ria
                <input type="number" name="cargaHoraria" min="20" max="120">
            </label>
            <button type="submit">Atualizar</button>
        </form>
        <form class="form-grid" data-action="delete-disciplina">
            <h3>Excluir disciplina</h3>
            <label>
                ID disciplina
                <input type="number" name="id" required>
            </label>
            <button type="submit" class="danger">Excluir</button>
        </form>
    </section>

    <section class="card card-wide">
        <h2>Estat√≠sticas do Sistema</h2>
        
        <!-- Estat√≠sticas Gerais -->
        <div class="stats-grid" th:if="${estatisticas}">
            <div class="stat-card">
                <h3>Total de Alunos</h3>
                <p class="stat-number" th:text="${estatisticas.totalAlunos}">0</p>
            </div>
            <div class="stat-card">
                <h3>Total de Disciplinas</h3>
                <p class="stat-number" th:text="${estatisticas.totalDisciplinas}">0</p>
            </div>
            <div class="stat-card">
                <h3>M√©dia Geral</h3>
                <p class="stat-number" th:text="${#numbers.formatDecimal(estatisticas.mediaGeralNotas, 1, 2)}">0.0</p>
            </div>
            <div class="stat-card">
                <h3>Taxa de Aprova√ß√£o</h3>
                <p class="stat-number" th:text="${#numbers.formatDecimal(estatisticas.taxaAprovacao, 1, 2)}%">0.0%</p>
            </div>
            <div class="stat-card">
                <h3>Freq. Baixa</h3>
                <p class="stat-number" th:text="${estatisticas.alunosFrequenciaBaixa}">0</p>
            </div>
        </div>

        <!-- Consultas Dispon√≠veis -->
        <ul class="consulta-list">
            <li th:each="consulta : ${consultas}" th:text="consulta">Consulta exemplo</li>
        </ul>

        <!-- Distribui√ß√£o por Sexo -->
        <div class="graficos-placeholder" th:if="${distribuicaoSexo}">
            <h3>Distribui√ß√£o por Sexo</h3>
            <table>
                <thead>
                <tr>
                    <th>Sexo</th>
                    <th>Quantidade</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${distribuicaoSexo}">
                    <td th:text="${item.descricao()}">M/F</td>
                    <td th:text="${item.valor()}">0</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Distribui√ß√£o por Idade -->
        <div class="graficos-placeholder" th:if="${distribuicaoIdade}">
            <h3>Distribui√ß√£o por Faixa Et√°ria</h3>
            <table>
                <thead>
                <tr>
                    <th>Faixa Et√°ria</th>
                    <th>Quantidade</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${distribuicaoIdade}">
                    <td th:text="${item.descricao()}">Faixa</td>
                    <td th:text="${item.valor()}">0</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Top Disciplinas -->
        <div class="graficos-placeholder" th:if="${topDisciplinas}">
            <h3>Top 5 Disciplinas (Carga Hor√°ria)</h3>
            <table>
                <thead>
                <tr>
                    <th>Disciplina</th>
                    <th>Carga Hor√°ria</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="item : ${topDisciplinas}">
                    <td th:text="${item.descricao()}">Disciplina</td>
                    <td th:text="${item.valor()}">0</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Top Alunos -->
        <div class="graficos-placeholder" th:if="${topAlunos}">
            <h3>Top 10 Alunos (Melhor Desempenho)</h3>
            <table>
                <thead>
                <tr>
                    <th>Nome</th>
                    <th>M√©dia</th>
                    <th>Frequ√™ncia</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="aluno : ${topAlunos}">
                    <td th:text="${aluno.nome}">Nome</td>
                    <td th:text="${#numbers.formatDecimal(aluno.media, 1, 2)}">0.0</td>
                    <td th:text="${#numbers.formatDecimal(aluno.frequencia, 1, 2)}%">0.0%</td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Gr√°ficos Estat√≠sticos -->
        <div class="graficos-section" th:if="${distribuicaoSexo}">
            <h3>üìä Gr√°ficos Estat√≠sticos</h3>
            
            <div class="charts-grid">
                <div class="chart-container">
                    <h4>Distribui√ß√£o por Sexo</h4>
                    <canvas id="sexoChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-container">
                    <h4>Distribui√ß√£o por Idade</h4>
                    <canvas id="idadeChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-container">
                    <h4>Top Disciplinas (Carga Hor√°ria)</h4>
                    <canvas id="disciplinasChart" width="400" height="200"></canvas>
                </div>
                
                <div class="chart-container">
                    <h4>M√©dias dos Alunos</h4>
                    <canvas id="mediasChart" width="400" height="200"></canvas>
                </div>
            </div>
        </div>

        <!-- Consultas Complexas -->
        <div class="consultas-section">
            <h3>üîç Consultas Complexas (Etapa 03)</h3>
            
            <div class="consulta-buttons">
                <button onclick="carregarConsulta('alunos-disciplinas')" class="consulta-btn">
                    üìö Alunos e Disciplinas
                </button>
                <button onclick="carregarConsulta('distribuicao-idade-sexo')" class="consulta-btn">
                    üë• Distribui√ß√£o por Idade e Sexo
                </button>
                <button onclick="carregarConsulta('analise-disciplinas')" class="consulta-btn">
                    üìä An√°lise de Disciplinas
                </button>
                <button onclick="carregarConsulta('situacao-academica')" class="consulta-btn">
                    üéì Situa√ß√£o Acad√™mica
                </button>
                <button onclick="carregarConsulta('ranking-professores')" class="consulta-btn">
                    üë®‚Äçüè´ Ranking de Professores
                </button>
            </div>
            
            <div id="consulta-resultado" class="consulta-resultado" style="display: none;">
                <h4>Resultado da Consulta</h4>
                <div id="consulta-tabela"></div>
            </div>
        </div>

        <!-- Mensagem de erro -->
        <div class="error-message" th:if="${erro}">
            <h3>‚ö†Ô∏è Erro</h3>
            <p th:text="${erro}">Erro ao carregar dados</p>
            <p><strong>Para resolver:</strong></p>
            <ol>
                <li>Certifique-se de que o MySQL est√° rodando</li>
                <li>Verifique as credenciais no application.properties</li>
                <li>Acesse <a href="/api/criar-tabelas" target="_blank">/api/criar-tabelas</a> para criar as tabelas</li>
            </ol>
        </div>
    </section>
</main>

<footer class="page-footer">
    <small>Etapa 03 - primeira vers√£o: estrutura para integra√ß√£o JDBC e dashboard</small>
</footer>

<script src="/js/dashboard.js"></script>
</body>
</html>
